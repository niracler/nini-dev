## Context

bokushi åšå®¢ç›®å‰æ˜¯çº¯ä¸­æ–‡ç«™ç‚¹ï¼Œ51 ç¯‡æ–‡ç« ï¼ˆblog 21 + til 17 + monthly 13ï¼‰ï¼Œæ‰€æœ‰å†…å®¹ç»Ÿä¸€æ”¾åœ¨ `src/content/blog/`ã€`src/content/til/`ã€`src/content/monthly/` ä¸‹ã€‚HTML `lang` å±æ€§ç¡¬ç¼–ç ä¸º `zh-CN`ï¼Œæ— ä»»ä½• i18n åŸºç¡€è®¾æ–½ã€‚

ç°æœ‰åŸºç¡€è®¾æ–½ï¼š

- Astro 5.16.9ï¼Œå·²å†…ç½® i18n è·¯ç”±æ”¯æŒï¼ˆ`astro.config.mjs` çš„ `i18n` é…ç½®é¡¹ï¼‰
- å†…å®¹é›†åˆä½¿ç”¨ `defineCollection` + glob loader
- åŠ¨æ€è·¯ç”± `src/pages/[...slug].astro` èšåˆæ‰€æœ‰é›†åˆçš„æ–‡ç« 
- é™æ€è¾“å‡º + Cloudflare Pages éƒ¨ç½²
- Pagefind å…¨æ–‡æœç´¢ã€RSS feedã€sitemap å·²é…ç½®

çº¦æŸï¼š

- ç°æœ‰ URL ç»“æ„ä¸èƒ½å˜ï¼ˆ`/elegant` ç­‰è·¯å¾„ä¿æŒä¸å˜ï¼‰
- ä¸­æ–‡æ˜¯é»˜è®¤è¯­è¨€ï¼Œè‹±æ–‡æ˜¯é€æ­¥æ·»åŠ çš„ç¿»è¯‘è¯­è¨€
- ä¸æ˜¯æ‰€æœ‰æ–‡ç« éƒ½æœ‰è‹±æ–‡ç‰ˆï¼Œè¯­è¨€åˆ‡æ¢åªåœ¨æœ‰ç¿»è¯‘æ—¶å‡ºç°
- monthly å’Œ til æš‚ä¸ç¿»è¯‘ï¼Œä¼˜å…ˆ blog é›†åˆ

## Goals / Non-Goals

**Goals:**

- å¯ç”¨ Astro åŸç”Ÿ i18n è·¯ç”±ï¼Œä¸­æ–‡æ— å‰ç¼€ã€è‹±æ–‡ `/en/` å‰ç¼€
- å†…å®¹ç›®å½•é‡æ„ä¸º `zh/`ã€`en/` å­ç›®å½•
- è¯­è¨€åˆ‡æ¢ç»„ä»¶ï¼ˆä»…æœ‰ç¿»è¯‘æ—¶æ˜¾ç¤ºï¼‰
- AI è¾…åŠ©ç¿»è¯‘å·¥ä½œæµï¼ˆè„šæœ¬æˆ– Claude Code skillï¼‰
- åŠ¨æ€ `<html lang>` å±æ€§
- hreflang å…ƒæ ‡ç­¾æ”¯æŒ SEO

**Non-Goals:**

- v1 ä¸ç¿»è¯‘ til å’Œ monthly é›†åˆ
- ä¸åš UI æ–‡æ¡ˆå›½é™…åŒ–ï¼ˆå¯¼èˆªã€é¡µè„šç­‰ä¿æŒä¸­æ–‡ï¼Œä»…è‹±æ–‡æ–‡ç« é¡µåˆ‡æ¢ langï¼‰
- ä¸åšè‡ªåŠ¨ç¿»è¯‘åŒæ­¥ï¼ˆæºæ–‡ä»¶æ›´æ–°åè‡ªåŠ¨è§¦å‘é‡ç¿»ï¼‰
- ä¸åšå¤šè¯­è¨€æœç´¢ï¼ˆPagefind æš‚ä¸æŒ‰è¯­è¨€åˆ†ç´¢å¼•ï¼‰
- ä¸æ”¯æŒè‹±æ–‡ä»¥å¤–çš„å…¶ä»–è¯­è¨€

## Decisions

### 1. i18n è·¯ç”±ç­–ç•¥ï¼šAstro åŸç”Ÿ i18n + é»˜è®¤è¯­è¨€æ— å‰ç¼€

**å†³å®šï¼š** ä½¿ç”¨ Astro å†…ç½® `i18n` é…ç½®ï¼Œ`defaultLocale: "zh"`ï¼Œ`routing: { prefixDefaultLocale: false }`

**åŸå› ï¼š**

- ä¸­æ–‡æ–‡ç« ä¿æŒ `/elegant`ï¼Œè‹±æ–‡æ–‡ç« ä¸º `/en/elegant`
- ç°æœ‰ URL é›¶å½±å“ï¼Œæ— éœ€ 301 é‡å®šå‘
- Astro åŸç”Ÿæ”¯æŒ locale æ£€æµ‹ã€`getRelativeLocaleUrl()` ç­‰å·¥å…·å‡½æ•°

**é…ç½®ï¼š**

```js
// astro.config.mjs
i18n: {
  defaultLocale: "zh",
  locales: ["zh", "en"],
  routing: {
    prefixDefaultLocale: false,
  },
}
```

### 2. å†…å®¹ç›®å½•ç»“æ„ï¼šå­ç›®å½•æ–¹æ¡ˆ

**å†³å®šï¼š** åœ¨æ¯ä¸ªé›†åˆä¸‹å»º `zh/`ã€`en/` å­ç›®å½•

**æ–¹æ¡ˆå¯¹æ¯”ï¼š**

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|
| A. å­ç›®å½• `blog/zh/`ã€`blog/en/` | æ¸…æ™°åˆ†ç¦»ï¼ŒAstro i18n å¤©ç„¶æ”¯æŒ | éœ€è¦è¿ç§»ç°æœ‰æ–‡ä»¶ |
| B. åç¼€ `elegant.en.md` | æ–‡ä»¶æ”¾ä¸€èµ·æ–¹ä¾¿å¯¹ç…§ | è·¯ç”±éœ€è¦è‡ªå®šä¹‰è§£æï¼ŒAstro ä¸åŸç”Ÿæ”¯æŒ |
| C. frontmatter `lang` å­—æ®µ | çµæ´» | è·¯ç”±é€»è¾‘å¤æ‚ï¼Œæ— æ³•åˆ©ç”¨ Astro i18n |

é€‰æ‹© **æ–¹æ¡ˆ A**ï¼ŒåŸå› ï¼šä¸ Astro i18n è·¯ç”±æœ€è‡ªç„¶åŒ¹é…ï¼Œé•¿æœŸç»´æŠ¤æ¸…æ™°ã€‚

**è¿ç§»åç»“æ„ï¼š**

```
src/content/
â”œâ”€â”€ blog/
â”‚   â”œâ”€â”€ zh/
â”‚   â”‚   â”œâ”€â”€ elegant.md
â”‚   â”‚   â”œâ”€â”€ about.mdx
â”‚   â”‚   â””â”€â”€ ...ï¼ˆç°æœ‰ 21 ç¯‡æ–‡ç« ç§»å…¥ï¼‰
â”‚   â””â”€â”€ en/
â”‚       â”œâ”€â”€ elegant.md      â† ç¿»è¯‘ç‰ˆ
â”‚       â””â”€â”€ about.mdx
â”œâ”€â”€ til/                    â† v1 ä¸åŠ¨
â”‚   â”œâ”€â”€ ...
â””â”€â”€ monthly/                â† v1 ä¸åŠ¨
    â”œâ”€â”€ ...
```

### 3. Slug ä¸è·¯ç”±æ˜ å°„

**å†³å®šï¼š** slug ä¸­å»æ‰ `zh/` å‰ç¼€ï¼Œä¿æŒä¸ç°æœ‰ URL ä¸€è‡´

**åŸå› ï¼š**

- glob loader ä¼šæŠŠ `zh/elegant.md` çš„ slug è§£æä¸º `zh/elegant`
- éœ€è¦åœ¨ `content.config.ts` æˆ–è·¯ç”±å±‚å‰¥ç¦» locale å‰ç¼€
- ä¸­æ–‡ `/elegant`ã€è‹±æ–‡ `/en/elegant` å…±äº«åŒä¸€ä¸ª base slug `elegant`

**å®ç°æ–¹å¼ï¼š** åœ¨ `getStaticPaths()` ä¸­å¤„ç† slug æ˜ å°„ï¼š

```
æ–‡ä»¶ blog/zh/elegant.md â†’ slug: "elegant" â†’ URL: /elegant
æ–‡ä»¶ blog/en/elegant.md â†’ slug: "elegant" â†’ URL: /en/elegant
```

### 4. ç¿»è¯‘å¯¹åº”å…³ç³»ï¼šåŸºäº slug åŒ¹é…

**å†³å®šï¼š** åŒ base slug çš„ä¸­è‹±æ–‡æ–‡ä»¶è‡ªåŠ¨è§†ä¸ºå¯¹åº”ç¿»è¯‘

**åŸå› ï¼š**

- ä¸éœ€è¦åœ¨ frontmatter ä¸­æ‰‹åŠ¨ç»´æŠ¤ `translations` æ˜ å°„
- `blog/zh/elegant.md` å’Œ `blog/en/elegant.md` è‡ªåŠ¨é…å¯¹
- è¯­è¨€åˆ‡æ¢ç»„ä»¶åªéœ€æ£€æŸ¥å¯¹åº”è¯­è¨€ç›®å½•ä¸‹æ˜¯å¦å­˜åœ¨åŒåæ–‡ä»¶

**æ›¿ä»£æ–¹æ¡ˆï¼š** frontmatter ä¸­åŠ  `translationOf: elegant`ã€‚æ›´çµæ´»ä½†å¢åŠ ç»´æŠ¤è´Ÿæ‹…ï¼Œslug åŒ¹é…å¯¹å½“å‰éœ€æ±‚å¤Ÿç”¨ã€‚

### 5. è¯­è¨€åˆ‡æ¢ç»„ä»¶ï¼šæ¡ä»¶æ¸²æŸ“

**å†³å®šï¼š** åœ¨ `BlogPost.astro` å¸ƒå±€ä¸­æ·»åŠ è¯­è¨€åˆ‡æ¢ï¼Œä»…å½“å¯¹åº”ç¿»è¯‘å­˜åœ¨æ—¶æ˜¾ç¤º

**ä½ç½®ï¼š** æ–‡ç« æ ‡é¢˜ä¸‹æ–¹ï¼Œç´§å‡‘çš„ inline é“¾æ¥æ ·å¼

```
ä¼˜é›…çš„å“²å­¦
ğŸŒ Read in English


æ­£æ–‡...
```

### 6. AI ç¿»è¯‘å·¥ä½œæµï¼šCLI è„šæœ¬

**å†³å®šï¼š** åˆ›å»º `scripts/translate.ts` è„šæœ¬ï¼Œè°ƒç”¨ Claude API ç¿»è¯‘

**æµç¨‹ï¼š**

```
pnpm translate <slug>
  â†’ è¯»å– src/content/blog/zh/<slug>.md
  â†’ æå– frontmatter + body
  â†’ è°ƒç”¨ Claude API ç¿»è¯‘ï¼ˆä¿ç•™ frontmatter ç»“æ„ï¼Œç¿»è¯‘ title/description/bodyï¼‰
  â†’ å†™å…¥ src/content/blog/en/<slug>.md
  â†’ è¾“å‡º diff ä¾›äººå·¥å®¡æ ¡
```

**æ›¿ä»£æ–¹æ¡ˆï¼š** Claude Code skillã€‚ä½†è„šæœ¬æ›´é€šç”¨ï¼Œä¸ä¾èµ– Claude Code ç¯å¢ƒï¼Œä¹Ÿå¯åœ¨ CI ä¸­ä½¿ç”¨ã€‚v2 å¯ä»¥è€ƒè™‘åšæˆ skill ä»¥è·å¾—æ›´å¥½çš„äº¤äº’ä½“éªŒã€‚

### 7. SEOï¼šhreflang æ ‡ç­¾

**å†³å®šï¼š** åœ¨ `BaseHead.astro` ä¸­åŠ¨æ€ç”Ÿæˆ hreflang `<link>` æ ‡ç­¾

```html
<!-- ä¸­æ–‡é¡µ /elegant -->
<link rel="alternate" hreflang="zh" href="https://niracler.com/elegant" />
<link rel="alternate" hreflang="en" href="https://niracler.com/en/elegant" />
<link rel="alternate" hreflang="x-default" href="https://niracler.com/elegant" />

<!-- è‹±æ–‡é¡µ /en/elegant -->
ï¼ˆåŒä¸Šï¼ŒåŒå‘å£°æ˜ï¼‰
```

ä»…åœ¨æœ‰ç¿»è¯‘å¯¹æ—¶è¾“å‡ºï¼Œé¿å…å­¤ç«‹çš„ hreflang å£°æ˜ã€‚

## Risks / Trade-offs

| é£é™© | ç¼“è§£æªæ–½ |
|------|----------|
| å†…å®¹ç›®å½•è¿ç§»å¯èƒ½ç ´åç°æœ‰ slug | è¿ç§»åè¿è¡Œ `pnpm build` éªŒè¯æ‰€æœ‰ URL æ­£å¸¸ç”Ÿæˆ |
| glob loader çš„ slug åŒ…å« `zh/` å‰ç¼€éœ€è¦å‰¥ç¦» | åœ¨ `getStaticPaths()` ä¸­ç»Ÿä¸€å¤„ç†ï¼Œå†™æµ‹è¯•éªŒè¯ |
| Pagefind æœç´¢ç»“æœå¯èƒ½æ··åˆä¸­è‹±æ–‡ | v1 å¯æ¥å—ï¼Œv2 è€ƒè™‘æŒ‰ `data-pagefind-meta="lang"` åˆ†ç´¢å¼• |
| AI ç¿»è¯‘è´¨é‡å‚å·®ä¸é½ | è„šæœ¬è¾“å‡ºåå¿…é¡»äººå·¥å®¡æ ¡ï¼Œä¸è‡ªåŠ¨å‘å¸ƒ |
| RSS feed éœ€è¦é€‚é…å¤šè¯­è¨€ | v1 å…ˆåªä¿ç•™ä¸­æ–‡ feedï¼Œv2 æ·»åŠ  `/en/rss.xml` |
| sitemap éœ€è¦åŒ…å« hreflang ä¿¡æ¯ | Astro sitemap æ’ä»¶æ”¯æŒ i18n é…ç½®ï¼Œéœ€è¦åŒæ­¥æ›´æ–° |

## Open Questions

- Astro 5 çš„ content collection glob loader åœ¨å­ç›®å½•ç»“æ„ä¸‹ï¼Œslug çš„å…·ä½“è§£æè¡Œä¸ºéœ€è¦éªŒè¯ï¼ˆæ˜¯å¦è‡ªåŠ¨åŒ…å«å­ç›®å½•è·¯å¾„ï¼‰
- `[...slug].astro` è·¯ç”±ä¸ Astro i18n è·¯ç”±çš„äº¤äº’â€”â€”æ˜¯å¦éœ€è¦æ”¹ä¸º `src/pages/[lang]/[...slug].astro` è¿˜æ˜¯è®© Astro i18n middleware å¤„ç†ï¼Ÿ
