# Design: Writing Skills 拆分

## Context

当前 `writing-assistant` skill 包含两个独立工作流（启发写作、审校润色）和四种文章类型（日记、游记、TIL、通用），其中日记功能远比其他复杂：有用户配置、Work Log 自动化、任务联动（Reminders 集成）、智能收尾流程。

用户日记存储在 Obsidian，通过 iCloud 同步，不需要 git 提交。Work Log 在工作日必须自动执行。

**时间约束**：完整日记流程应控制在 **45 分钟**（一个番茄钟）内完成。

## Goals / Non-Goals

**Goals:**

- 将 `writing-assistant` 拆分为 3 个职责单一的 skill
- `diary-assistant` 提供完整的日记流程，包含任务联动
- 所有 skill 的 description 符合 CSO 规范（以 "Use when..." 开头）
- 复用现有 reference 文件，减少重复
- **流程效率**：日记流程控制在 45 分钟内

**Non-Goals:**

- 不修改被调用的 skill（`schedule-manager`, `anki-card-generator`, `yunxiao`）
- 不改变日记存储位置（保持 Obsidian）
- 不添加新的日记模板结构

## Decisions

### 1. Skill 拆分粒度

**决定**: 拆成 3 个 skill（diary-assistant / writing-inspiration / writing-proofreading）

**替代方案**:

- 2 个 skill（日记独立 + 其他合并）→ 启发和审校仍混在一起
- 保持 1 个（优化内部结构）→ description 仍会过长，职责仍混乱

**理由**: 日记、启发、审校是三个完全独立的用户意图和工作流

### 2. Work Log 触发方式

**决定**: 工作日自动执行，不询问

**替代方案**:

- 每次询问 → 增加用户负担
- 用户配置决定 → 过度设计

**理由**: Work Log 是工作日必须的，询问是多余的

### 3. 任务回顾方式（简化版）

**决定**: 批量勾选完成的任务，未完成的默认延期到明天

```
今日计划的 5 件事：
1. 写文档
2. 修 bug
3. 开会
4. 回复邮件
5. 复习英语

哪些完成了？（输入序号，如「1,3」，或「全部」/「都没完成」）
```

**替代方案**:

- 逐个确认每个任务的状态（完成/延期/取消）→ 太慢，5 个任务要 5 轮对话
- 只问「完成了几件」→ 不知道具体哪些完成了

**理由**: 一次性处理，节省时间，未完成的默认延期到明天是最常见的处理方式

### 4. 任务捕获方式（合并到启发提问）

**决定**: 在启发提问中自然询问「之后有什么计划」，直接解析并写入 Reminders

**替代方案**:

- 全程实时捕获 + 结尾确认 → 增加一个确认步骤，拖慢流程
- 完全不主动询问 → 用户可能忘记记录待办

**理由**: 作为启发提问的一部分自然融入，不增加额外步骤

### 5. 已存在日记的处理

**决定**: 检测文件是否存在，提供三个选项（继续 / 追加 / 重新开始）

**替代方案**:

- 默认追加 → 可能不是用户想要的
- 默认覆盖 → 可能丢失之前记录的内容

**理由**: 让用户明确选择，避免意外覆盖

### 6. 启发提问适应性

**决定**: 工作日（有 Work Log）和周末问不同的问题，最后一个问题固定为「之后有什么计划」

| 场景   | 问题                                                   |
| ------ | ------------------------------------------------------ |
| 工作日 | 「工作之外，今天还有什么想记录的？」「之后有什么计划？」 |
| 周末   | 「今天做了什么？」「有什么收获或感受？」「之后有什么计划？」 |

**替代方案**:

- 统一问题列表 → 工作日会重复（Work Log 已有的内容）
- 完全自由 → 可能遗漏重要内容

**理由**: 减少重复，提高效率；计划问题作为固定结尾，自然过渡到任务创建

### 7. 收尾流程触发

**决定**: 智能推荐（检测内容关键词）

**替代方案**:

- 全部询问 → 每次多个问题，用户疲劳
- 不主动询问 → 用户可能忘记

**理由**: 根据日记内容智能判断更自然

## 完整流程图

```
┌─────────────────────────────────────────────────────────────────────┐
│          diary-assistant 完整流程（目标 ≤45min）                     │
└─────────────────────────────────────────────────────────────────────┘

  ┌──────────────┐
  │ 用户触发日记  │
  └──────┬───────┘
         │
         ▼
  ┌────────────────────────────────────┐
  │ 1. Pre-Diary Clarification  (~1min) │
  │    确认日期：2026-01-29.md         │
  └──────┬─────────────────────────────┘
         │
         ▼
    ┌────┴──────────┐
    │ 日记文件已存在？ │
    └────┬──────────┘
      是 │         │ 否
         ▼         │
  ┌─────────────┐  │
  │ 选择模式：   │  │
  │ 继续/追加/  │  │
  │ 重新开始    │  │
  └──────┬──────┘  │
         └────┬────┘
              ▼
  ┌────────────────────────────────────┐
  │ 2. 今日任务回顾（简化）    (~2min)   │
  │    调用 schedule-manager            │
  │                                    │
  │    「今日计划 5 件事：              │
  │     1.写文档 2.修bug 3.开会...」    │
  │    「哪些完成了？输入序号」          │
  │                                    │
  │    → 未完成的默认延期到明天         │
  └──────┬─────────────────────────────┘
         │
         ▼
    ┌────┴────┐
    │ 是工作日？│
    └────┬────┘
     是  │      │ 否
         ▼      │
  ┌──────────┐  │
  │ Work Log │  │  (~2-3min) 自动获取
  │ git/云效  │  │
  └────┬─────┘  │
       └───┬────┘
           ▼
  ┌────────────────────────────────────┐
  │ 3. 启发提问（适应性）    (~20-25min) │
  │                                    │
  │    工作日：                         │
  │    Q1「工作之外还有什么想记录的？」  │
  │    Q2「之后有什么计划？」           │
  │                                    │
  │    周末：                           │
  │    Q1「今天做了什么？」             │
  │    Q2「有什么收获或感受？」         │
  │    Q3「之后有什么计划？」           │
  │                                    │
  │    → 计划直接解析为 Reminders       │
  └──────┬─────────────────────────────┘
         │
         ▼
  ┌────────────────────────────────────┐
  │ 4. 整理成文              (~10min)   │
  └──────┬─────────────────────────────┘
         │
         ▼
  ┌────────────────────────────────────┐
  │ 5. 智能收尾              (~0-5min)  │
  │    检测到 TIL → 「要生成 Anki 吗？」│
  └──────┬─────────────────────────────┘
         │
         ▼
      ┌──────┐
      │ 完成  │  总计 ~35-45min
      └──────┘
```

## 时间预算

| 步骤                   | 时间      |
| ---------------------- | --------- |
| 确认日期 + 文件处理    | ~1 min    |
| 任务回顾（简化）       | ~2 min    |
| Work Log（自动）       | ~2-3 min  |
| 启发提问（含计划）     | ~20-25 min |
| 整理成文               | ~10 min   |
| 智能收尾（可选）       | ~0-5 min  |
| **总计**               | **~35-45 min** |

## Risks / Trade-offs

| Risk                                                   | Mitigation                                               |
| ------------------------------------------------------ | -------------------------------------------------------- |
| Skill 发现冲突：三个 skill 的触发词可能有重叠          | 确保 description 中的触发条件足够具体和互斥              |
| Reference 文件冗余：拆分后部分 reference 可能重复      | 共享的内容保留在最相关的 skill 中，其他 skill 通过引用说明 |
| 迁移期混乱：用户可能习惯说「writing-assistant」        | 在 description 中明确新的触发词，旧 skill 删除时无歧义   |
| 任务回顾简化导致信息丢失                               | 未完成任务默认延期到明天，用户可以额外说明特殊情况       |
| 计划解析不准确                                         | 创建 Reminders 前显示解析结果让用户确认                  |

## 依赖关系

**diary-assistant 调用的 skill**：

| Skill                 | 用途                       | 触发时机                    |
| --------------------- | -------------------------- | --------------------------- |
| `schedule-manager`    | 获取今日任务               | 日记开始时                  |
| `schedule-manager`    | 处理延期任务 + 写入新计划  | 任务回顾后 + 启发提问结束后 |
| `anki-card-generator` | 生成记忆卡片               | 检测到 TIL 内容             |
| `yunxiao`             | 获取云效工作记录           | Work Log 自动化（仅云效仓库）|

**不需要调用**：`git-workflow`（日记存储在 Obsidian，不需要 git 提交）
